Bangle.setLCDPower(1);
Bangle.setLCDTimeout(1);
const storage = require('Storage');

//draw clock image
function getImg() {
  return require("heatshrink").decompress(atob("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"));
}
var IMAGEWIDTH = 176;
var IMAGEHEIGHT = 176;

//set clockface font
Graphics.prototype.setFontmegamanx = function() {
  // Actual height 12 (11 - 0)
  // 1 BPP
  return this.setFontCustom(
    E.toString(require('heatshrink').decompress(atob('ACUH9l+44CB4AICsF2g/gvgRDBA0Nw/8v/DjExAoXH/k2BwM9w/cBAV/41ss3Hvk3wEAmEHwFIo+YgcA4EZw08ofAnkAgd4DQPstwgC4d4m/AthcHgFwJQN+NZED/k/4//uHwC4UPuH3/8/OgMxwf4h0HGQPA8E/wcYCoPAhgCBMQYCBBAQCBAAcB4EcgPwj4HBsEGARRMFDQYCBKgUA+EMBAN4C4PgngKBuAGBCAP4IIVg40MAoIIBL4IsFKwpoBOIK8Bu/GvlnBYL1Cnz1Cg3MtnGAQIdEn7UBaYP4nqJBuLyEFgV84/MAQfG/lvAQQdBn4XCFgQOHMQMcs5KBFIeH/DjCm4dFJQk3DoM+L4N+41ssxZHAAtx48cAQQMGg8buP3j9x+CCBgH4h+D/l9+8PuH2YAIABmKABARAoFsE3DQP378/4AmBwD7BgfAvkGjdh20bs+2sF+BYMAgP8mFmvXfzeJ0eb/P820+aIMIFwN8n5xBs0GsACCv/D/hlBQAbjCZAQOBvA+B/AOCXIMMAQVx4ZfBDogOFDoP4NYTODF4gCCBxBNFHZF249su/Dvg7FXgNgAQQICU4YsEv5NCS4XGjhTDBwWH/A5BI4nA8E/w/8fwQdCHYoRBhkAAQoOCVQMP4H8n/D8BKFAoQLBCIOAvAODO44yDUgQ7ESQt+gfgDo9ss/GjAdB9gdIFgncDoPYvoIBt3G9gOBvizBd4KuEagq3DNASSBQwMcgICCCgWAgFwg/gvxBBRIMch/H/F8g/AEBAvCEArjBBYKDBZBAvB4AmBVQK5C4/ABYItBg0cQwN8AQP8v3H5l847XBAAhuGX4IvCvEA+BrBEwQLBBwQXEn5TBgBDBfAR3B8E+gf8J4I1BEAUAAoQCIIohcBR4V8gYMDm/Dvk24dsGQJ3CMQZfFhiDBh5KCgH4h+DC4PDhk9fYQABZAIUBDojCBDQw4Cn3A9hgFWYIaDtgMC4H/n+zjc/+f/F4RQJgA7BPQsG/lvaINvBYcPXwMDt/2/4OCExB0B7BrBdJgICTYUwZYIFBBAYOFCIxEBTwswBwI4B/AaDOgICCmOD/E/XgUDAoODjARFKAo4FVQRgE7kNBwd8AQLaDhkHa4oaEHAZcChgaBKYMDGoILBgLIBAoPAngLBIgYOBgA4CDoaMDPQMMWAP8g4UBWwUwagUDC4IsBdIP4h0D8E8JQccmJiBm/Dtk+4fMBoUCgfevP0gMAg6PBgkBvnz70CD4UAkAFBmASBiAKBA=='))),
    32,
    atob("DAYMCgoLCgkKBgkLBwoIDAoJCgoKCgoKCgoJCQkKDAoMCgoKCgoKCgoJCgoLCgoKCgoKCgsKDAoKCwoLBAoMCgkKCQkJCQkJCQgJCggKCQkJCQsJCQkKCgsKCQYCBQc="),
    12 | 65536
  );
}

//get smaller font 
Graphics.prototype.setFontmegamanxsmall = function() {
  // Actual height 8 (7 - 0)
  // 1 BPP
  return this.setFontCustom(
    E.toString(require('heatshrink').decompress(atob('ABH0AAIEB6Hw8ADElH8/lIAQNQgFo9gFByncrEA8nsnF87kcgFY/m0B4NciguD4Hw+A2Evn+4wEB43+vkApF4DQN4pEAkEgAwP8AgIZChkOh0AiAAEBgYABgECg0MjEwsHAwEAFIWE/n4vAWCFYX8gFM7nczn8+l0BoOkAAJDCgEYnFo5AXD8gAB3m83AtD0gHDwmMEoI1BOoKEBB4ICBSYN0WAOUFwYAC5gABAwfK53OOIKoB93GwQLBpAAECgWC43uvk4QQNg8GKxWa+FggE+8//9v///+gEcvn8yGQ/i2BJgXkJgSSDwnMF4IGDKYZ/CRoQHEEwOQDwnU7lcBwbOBTQSMBBIWEaoOMA4X4aAKGC/nMBwIeDggABAwV8nheBEoQICnAHCd4hVCJYfwuAODyjKBd4IOCAQNsgFo9n82n87h6BwGAHwQEBgH4AoMMhhVBgHA+H8nk8/HgCAgACCAKfBMwvA8BWBvng4EAxmczm8+nk4jjCRgYXBuEcS4S+CNIUEbwPw+F8jiKBBIIAEEYQ1B8D9BgFcrlUHYIOCGIU8nAGBnAMBtiBBgBnBB4QNDql0mgGBkC7C0A4Bn16v1+ngpFAwUA3gABAgMGg2+3wGCCYU4tlEPAoEBIYIADA4xSDoj1BBoI8Bv14RALsBvAICFIQaCkEgAwMsA4RwCkA4CBoV4BoQjBoAGBnl4sFABwpIDolsEgReCI4KjBuC0Cpi1BulkLAP/4cA/0A4f/iEAjAACgAA='))),
    32,
    atob("CAUJCAgHCAcIBQcIBgcGCQgHCAgIBwgICAgHBwcICQgICAcIBwgICAgHCAcICAgIBwgHCAgICQgICAgIAwgJCAcIBwcHBwcHBwYHCAYIBwcHBwgHBwcICAgIBwQCBAU="),
    8 | 65536
  );
}
// timeout used to update every minute
var drawTimeout;

// schedule a draw for the next minute
function queueDraw() {
  if (drawTimeout) clearTimeout(drawTimeout);
  drawTimeout = setTimeout(function() {
    drawTimeout = undefined;
    draw();
  }, 60000 - (Date.now() % 60000));
}


function draw() {
  var x = g.getWidth() / 2;
  var y = 24 + 20;

  g.reset().clearRect(0, 24, g.getWidth(), g.getHeight() - IMAGEHEIGHT);
  if (g.getWidth() == IMAGEWIDTH)
    g.drawImage(getImg(), 0, g.getHeight() - IMAGEHEIGHT);
  else {
    let scale = g.getWidth() / IMAGEWIDTH;
    y *= scale;
    g.drawImage(getImg(), 0, g.getHeight() - IMAGEHEIGHT * scale, {
      scale: scale
    });
  }

  function getSteps() {
    var steps = Bangle.getHealthStatus("day").steps;
    steps = Math.round(steps / 1000);
    return steps + "k";
  }
  
function bigThenSmall(big, small, x, y) {
  g.setFont("megamanx");
  g.drawString(big, x, y);
  x += g.stringWidth(big);
  g.setFont("megamanxsmall");
  g.drawString(small, x, y);
}
  
function drawBattery() {
  bigThenSmall(E.getBattery(), "%", 115, 111);
}


  // work out locale-friendly date/time
  var date = new Date();
  var timeStr = require("locale").time(date, 1);
  var dateStr = require("locale").date(new Date(), 1);
  var dowStr = require("locale").dow(date).toUpperCase();
  // draw time
  y += -5;
  g.setFontAlign(-1, -20).setFont("megamanx");
  g.drawString(timeStr, x, y);
  y += -13;
  // draw date
  g.setFontAlign(-1, -18).setFont("megamanxsmall", );
  g.drawString(dateStr, x, y);
  y += -15;
  // draw the day of the week
  g.setFontAlign(-1, -12).setFont("megamanxsmall");
  g.drawString(dowStr, x, y);
  // queue draw in one minute
  queueDraw();
  //draw heart rate
  g.setFontAlign(-2, 10);
  g.setFont("megamanx");  g.drawString(Math.round(Bangle.getHealthStatus().bpm || Bangle.getHealthStatus("last").bpm), 115, 83);
  //draw steps
  g.setFontAlign(4,-5);
  g.setFont("megamanx");
  g.drawString(getSteps(), 135, 92);
  //draw battery
  g.setFontAlign(-7, -10);
  g.setFont("megamanx");
  drawBattery();
}

// Clear the screen once, at startup
g.setTheme({
  fg: "#fff",
  dark: true
}).clear();
// draw immediately at first, queue update
draw();
// Stop updates when LCD is off, restart when on
Bangle.on('lcdPower', on => {
  if (on) {
    draw(); // draw immediately, queue redraw
  } else { // stop draw timer
    if (drawTimeout) clearTimeout(drawTimeout);
    drawTimeout = undefined;
  }
});
// Show launcher when middle button pressed
Bangle.setUI("clock");
